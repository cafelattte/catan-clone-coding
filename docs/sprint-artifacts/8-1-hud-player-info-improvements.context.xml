<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>8</epicId>
    <storyId>1</storyId>
    <title>HUD 및 플레이어 정보 개선</title>
    <status>drafted</status>
    <generatedAt>2025-12-02</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/8-1-hud-player-info-improvements.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>플레이어</asA>
    <iWant>게임 상태와 다른 플레이어 정보를 더 명확하게 볼 수 있어</iWant>
    <soThat>전략적 의사결정을 더 쉽게 할 수 있음</soThat>
    <tasks>
      <task id="1" title="Admin 모드 구현" ac="8-1.1">
        <subtask id="1.1">game.lua에 adminMode 플래그 추가 (이미 존재, 확인 필요)</subtask>
        <subtask id="1.2">F1 키 토글 핸들러 구현</subtask>
        <subtask id="1.3">HUD에서 adminMode에 따른 자원 표시 분기 (이미 구현됨)</subtask>
      </task>
      <task id="2" title="플레이어 정보 패널 확장" ac="8-1.1, 8-1.2">
        <subtask id="2.1">모든 플레이어 패널 레이아웃 설계</subtask>
        <subtask id="2.2">자원 표시 (adminMode 시 상세, 아닐 때 카드 수) - 이미 구현됨</subtask>
        <subtask id="2.3">건물 개수 표시 (R:X S:X C:X) - 이미 구현됨</subtask>
        <subtask id="2.4">현재 플레이어 강조 스타일 - 이미 구현됨</subtask>
      </task>
      <task id="3" title="건설 비용 툴팁 시스템" ac="8-1.3">
        <subtask id="3.1">기본 툴팁 렌더링 함수 구현</subtask>
        <subtask id="3.2">버튼 호버 감지 로직</subtask>
        <subtask id="3.3">각 건물 타입별 비용 툴팁 데이터</subtask>
      </task>
      <task id="4" title="건설 가능 여부 시각 피드백" ac="8-1.4">
        <subtask id="4.1">자원 부족 시 버튼 비활성화 스타일</subtask>
        <subtask id="4.2">부족한 자원 표시 (빨간색 텍스트 또는 아이콘)</subtask>
      </task>
      <task id="5" title="주사위 결과 타일 하이라이트" ac="8-1.5">
        <subtask id="5.1">BoardView에 highlightTiles(number) 함수 추가</subtask>
        <subtask id="5.2">주사위 굴림 후 하이라이트 타일 저장</subtask>
        <subtask id="5.3">자원 획득 정보 팝업/오버레이 표시</subtask>
        <subtask id="5.4">하이라이트 해제 조건 구현 (시간 또는 다음 액션)</subtask>
      </task>
      <task id="6" title="배치 불가 피드백" ac="8-1.6">
        <subtask id="6.1">Settlement 버튼 클릭 시 유효 위치 체크</subtask>
        <subtask id="6.2">위치 없을 때 피드백 메시지 표시</subtask>
        <subtask id="6.3">메시지 자동 해제 (타이머 또는 클릭)</subtask>
      </task>
      <task id="7" title="테스트 및 검증" ac="All">
        <subtask id="7.1">adminMode 토글 테스트</subtask>
        <subtask id="7.2">플레이어 패널 정보 표시 확인</subtask>
        <subtask id="7.3">툴팁 표시 확인</subtask>
        <subtask id="7.4">주사위 하이라이트 확인</subtask>
        <subtask id="7.5">피드백 메시지 확인</subtask>
      </task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <ac id="8-1.1" title="Admin 모드 및 플레이어 자원 표시">
      <criterion>adminMode = true일 때 모든 플레이어의 자원 상세 표시 (W:2 B:1 S:3 등)</criterion>
      <criterion>adminMode = false일 때 다른 플레이어는 총 카드 수만 표시 ("5 cards")</criterion>
      <criterion>키보드 토글로 adminMode 전환 (예: F1 키)</criterion>
      <status>partial - adminMode 플래그와 HUD 로직 구현됨, F1 토글 미구현</status>
    </ac>
    <ac id="8-1.2" title="건물 현황 표시">
      <criterion>각 플레이어 패널에 도로/정착지/도시 개수 표시 (R:3 S:2 C:1)</criterion>
      <criterion>현재 플레이어는 강조 표시</criterion>
      <status>implemented - HUD.drawScorePanel에서 구현됨</status>
    </ac>
    <ac id="8-1.3" title="건설 비용 툴팁">
      <criterion>Settlement/City/Road 버튼에 마우스 호버 시 필요 자원 표시</criterion>
      <criterion>툴팁 예: "Wood 1, Brick 1, Sheep 1, Wheat 1"</criterion>
      <status>not-implemented</status>
    </ac>
    <ac id="8-1.4" title="건설 가능 여부 피드백">
      <criterion>자원이 부족한 건설 버튼은 시각적으로 비활성화 표시</criterion>
      <criterion>부족한 자원이 무엇인지 색상 또는 아이콘으로 표시</criterion>
      <status>partial - 버튼 비활성화 스타일 존재, 부족 자원 표시 미구현</status>
    </ac>
    <ac id="8-1.5" title="주사위 결과 타일 강조">
      <criterion>주사위 굴림 후 해당 숫자의 타일들 하이라이트</criterion>
      <criterion>자원 획득 정보 표시 (누가 무엇을 얻었는지)</criterion>
      <criterion>일정 시간 후 하이라이트 해제 또는 다음 액션 시 해제</criterion>
      <status>not-implemented</status>
    </ac>
    <ac id="8-1.6" title="Settlement 배치 불가 피드백">
      <criterion>Settlement 버튼 클릭 시 배치 가능한 위치가 없으면 피드백 메시지 표시</criterion>
      <criterion>"No valid settlement locations" 또는 유사한 메시지</criterion>
      <status>not-implemented</status>
    </ac>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/epics.md</path>
        <title>Epic Breakdown</title>
        <section>Epic 8, Story 8.1</section>
        <snippet>HUD 및 플레이어 정보 개선 요구사항, AC 정의, 기술적 고려사항 포함</snippet>
      </doc>
      <doc>
        <path>docs/game-architecture.md</path>
        <title>Game Architecture</title>
        <section>Project Structure, Data Architecture</section>
        <snippet>src/ui/hud.lua 위치, GameState 구조 (players, turn, buildings), Constants 모듈 활용</snippet>
      </doc>
      <doc>
        <path>docs/GDD.md</path>
        <title>Game Design Document</title>
        <section>Resource Systems, Controls and Input</section>
        <snippet>5종 자원 타입, 건물 비용 정의, 마우스 호버 하이라이트 명시</snippet>
      </doc>
    </docs>
    <code>
      <file>
        <path>src/ui/hud.lua</path>
        <kind>ui-module</kind>
        <symbol>HUD.draw, HUD.drawResourcePanel, HUD.drawScorePanel, CONFIG</symbol>
        <lines>43-278</lines>
        <reason>메인 HUD 모듈 - 플레이어 자원/점수 표시, adminMode 분기 로직 이미 구현됨</reason>
      </file>
      <file>
        <path>src/scenes/game.lua</path>
        <kind>scene</kind>
        <symbol>game:enter, game:keypressed, drawActionButton, actionButtons, adminMode</symbol>
        <lines>62-614</lines>
        <reason>게임 씬 - adminMode 플래그, 버튼 렌더링/클릭 처리, F1 토글 추가 위치</reason>
      </file>
      <file>
        <path>src/ui/board_view.lua</path>
        <kind>ui-module</kind>
        <symbol>BoardView.draw, drawHexagon, drawNumberToken</symbol>
        <lines>326-356</lines>
        <reason>타일 하이라이트 기능 추가 위치 - highlightTiles(number) 구현 필요</reason>
      </file>
      <file>
        <path>src/game/constants.lua</path>
        <kind>data</kind>
        <symbol>Constants.BUILD_COSTS, Constants.RESOURCE_TYPES</symbol>
        <lines>24-29</lines>
        <reason>건설 비용 데이터 - 툴팁에 사용</reason>
      </file>
      <file>
        <path>src/game/player.lua</path>
        <kind>model</kind>
        <symbol>Player:getAllResources, Player:canBuild</symbol>
        <lines>33-39</lines>
        <reason>플레이어 자원 조회 및 건설 가능 여부 체크</reason>
      </file>
      <file>
        <path>src/game/rules.lua</path>
        <kind>logic</kind>
        <symbol>Rules.getValidSettlementLocations</symbol>
        <lines>197-236</lines>
        <reason>유효한 정착지 위치 조회 - 배치 불가 피드백에 사용</reason>
      </file>
      <file>
        <path>src/ui/colors.lua</path>
        <kind>config</kind>
        <symbol>Colors.PLAYER, Colors.TERRAIN</symbol>
        <reason>플레이어 색상, 지형 색상 정의</reason>
      </file>
    </code>
    <dependencies>
      <lua>
        <package>love2d</package>
        <version>11.5+</version>
        <usage>렌더링, 입력 처리</usage>
      </lua>
      <lua>
        <package>classic</package>
        <version>latest</version>
        <location>lib/classic.lua</location>
        <usage>클래스 시스템</usage>
      </lua>
      <lua>
        <package>hump.gamestate</package>
        <version>latest</version>
        <location>lib/hump/gamestate.lua</location>
        <usage>씬 관리</usage>
      </lua>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint type="architecture">UI 모듈(src/ui/)과 게임 로직(src/game/) 분리 유지</constraint>
    <constraint type="pattern">HUD는 GameState를 읽기만 함, 수정하지 않음</constraint>
    <constraint type="naming">함수: camelCase, 상수: UPPER_SNAKE</constraint>
    <constraint type="testing">src/game/ 로직은 busted로 단위 테스트, UI는 수동 통합 테스트</constraint>
    <constraint type="performance">60 FPS 유지</constraint>
    <constraint type="style">미니멀/플랫 디자인, 기존 색상 팔레트 사용</constraint>
  </constraints>

  <interfaces>
    <interface>
      <name>HUD.draw</name>
      <kind>function</kind>
      <signature>function HUD.draw(gameState, screenWidth, screenHeight)</signature>
      <path>src/ui/hud.lua:240</path>
    </interface>
    <interface>
      <name>HUD.drawScorePanel</name>
      <kind>function</kind>
      <signature>function HUD.drawScorePanel(players, currentPlayerId, x, y, adminMode)</signature>
      <path>src/ui/hud.lua:88</path>
    </interface>
    <interface>
      <name>Constants.BUILD_COSTS</name>
      <kind>table</kind>
      <signature>{road={wood=1,brick=1}, settlement={wood=1,brick=1,sheep=1,wheat=1}, city={wheat=2,ore=3}}</signature>
      <path>src/game/constants.lua:24</path>
    </interface>
    <interface>
      <name>Rules.getValidSettlementLocations</name>
      <kind>function</kind>
      <signature>function Rules.getValidSettlementLocations(board, playerId, isInitialPlacement) -> table</signature>
      <path>src/game/rules.lua:197</path>
    </interface>
    <interface>
      <name>Player:canBuild</name>
      <kind>method</kind>
      <signature>function Player:canBuild(buildingType) -> boolean</signature>
      <path>src/game/player.lua</path>
    </interface>
    <interface>
      <name>drawActionButton</name>
      <kind>function</kind>
      <signature>function drawActionButton(btn, isEnabled, isHovered)</signature>
      <path>src/scenes/game.lua:161</path>
    </interface>
  </interfaces>

  <tests>
    <standards>
      UI 관련 변경은 주로 수동 통합 테스트로 검증. Love2D 의존 코드는 busted로 테스트 불가.
      src/game/ 순수 로직만 단위 테스트 가능. 기존 테스트 패턴 따름:
      describe/it 구조, before_each 설정, Arrange-Act-Assert 패턴.
    </standards>
    <locations>
      <location>tests/game/*_spec.lua</location>
    </locations>
    <ideas>
      <idea ac="8-1.1">F1 키 입력 시 adminMode 토글 확인 (수동 테스트)</idea>
      <idea ac="8-1.2">플레이어 패널에 R:X S:X C:X 형식 건물 개수 표시 확인 (수동 테스트)</idea>
      <idea ac="8-1.3">Settlement/City/Road 버튼 호버 시 툴팁 표시 확인 (수동 테스트)</idea>
      <idea ac="8-1.4">자원 부족 시 버튼 비활성화 및 부족 자원 표시 확인 (수동 테스트)</idea>
      <idea ac="8-1.5">주사위 굴림 후 해당 숫자 타일 하이라이트 확인 (수동 테스트)</idea>
      <idea ac="8-1.6">Settlement 선택 시 유효 위치 없으면 메시지 표시 확인 (수동 테스트)</idea>
    </ideas>
  </tests>
</story-context>
